{% extends "jiya/jiya_base.html" %}

{% block title %}
<!-- public timeline where we can post updates in our school & career journey.  -->
    <h1 id="jiya-hobbies-title">My timeline,</h1>
{% endblock title %}

{% block content %}

    <form id="form">
        
        <div>
            <label id="jiya_label1" for="name"> Enter your name: </label>
            <input name="name" type="text" id="name" autocomplete="on">
        </div>

        <div>
            <label id="jiya_label2" for="mail"> Enter your email: </label>
            <input name="email" type="email" id="email" autocomplete="on">
        </div>
    
        <div>
            <label id="jiya_label3" for="content"> Enter your content: </label>
            <input name="content" type="text" id="content" autocomplete="on">
        </div>
    
        <div>
            <button type="submit">Submit</button>
        </div>
        
    </form> 

    <ul></ul>


    <script>
        const form = document.getElementById('form')
        form.addEventListener('submit', function(e) {
            // prevent default HTML submission of form
            e.preventDefault();
            
            // converts form elements to array data
            const prePayload = new FormData(form);
            const payload= new URLSearchParams(prePayload); 
            console.log([...payload])
            
            // issue the POST request?
            fetch('http://127.0.0.1:5000/api/timeline_post', {
                method: "POST",
                body: payload,
            })
                .then(res => res.json())
                .then(data => console.log(data))
                .catch(err => console.log(err)); 

        })


       

    </script>

    <script>
        // GET request
        fetch('http://127.0.0.1:5000/api/timeline_post')
            .then(res => {
                return res.json();
                // console.log(res);

            })
            .then(data => {
                // parses JSON string to create JS
             
                // console.log(data);
                for (const user in data) {
                    console.log(user.name)
                    const markup = `<li>${user}</li>`;
                    document.querySelector('ul').insertAdjacentHTML('beforeend', markup);
                }

            })
            .catch(error => console.log(error));
    </script>

{% endblock content %}